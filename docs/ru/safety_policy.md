# Политика безопасности

## Обзор

Политика безопасности Trading Research Assistant предназначена для защиты пользователей от потенциально опасных или необоснованных торговых рекомендаций. Система включает несколько уровней проверок перед выдачей рекомендаций.

## Принципы безопасности

### 1. Проверка контекста

Каждая рекомендация должна быть основана на:
- Достаточном количестве исторических данных (минимум 200 свечей)
- Актуальных технических индикаторах
- Контексте новостей (если доступен)

### 2. Валидация данных

Система проверяет:
- Корректность таймфрейма (только разрешенные значения)
- Наличие достаточного объема данных
- Валидность символов и параметров

### 3. Ограничения риска

Рекомендации должны включать:
- Уровень уверенности (confidence) от 0.0 до 1.0
- Краткое обоснование (brief)
- Детальное обоснование (rationale)

## Компоненты безопасности

### Constraints (`core/policies/constraints.py`)

Модуль определяет ограничения и валидацию:

- **Минимальное количество свечей**: 200 (настраивается через `RUNTIME_MARKET_DATA_WINDOW_CANDLES`)
- **Разрешенные таймфреймы**: 1m, 5m, 15m, 30m, 1h, 4h, 1d
- **Валидация символов**: проверка формата (например, EURUSD, GBPUSD)

### Safety Policy (`core/policies/safety_policy.py`)

Основная политика безопасности проверяет рекомендации перед выдачей:

1. **Проверка уверенности**: Рекомендации с низкой уверенностью (< 0.3) могут быть отклонены
2. **Проверка обоснования**: Рекомендация должна содержать обоснование
3. **Проверка контекста**: Рекомендация должна соответствовать текущему рыночному контексту

## Настройки безопасности

Настройки безопасности находятся в `src/app/settings.py`:

```python
# Минимальное количество свечей для анализа
RUNTIME_MARKET_DATA_WINDOW_CANDLES=300

# Интервал между вызовами LLM (защита от перегрузки)
RUNTIME_LLM_CALL_INTERVAL_SECONDS=300

# Включение/выключение LLM (для тестирования без LLM)
RUNTIME_LLM_ENABLED=true
```

## Журнал сделок

Система ведет журнал всех рекомендаций и их результатов:

- **JournalEntry**: Запись о принятом решении (CALL, PUT, SKIP)
- **Outcome**: Результат сделки (WIN, LOSS, DRAW, VOID)

Это позволяет:
- Отслеживать эффективность рекомендаций
- Анализировать паттерны
- Улучшать систему на основе реальных данных

## Рекомендации по использованию

### Для пользователей

1. **Всегда проверяйте рекомендации**: Система предоставляет рекомендации, но окончательное решение за вами
2. **Используйте журнал**: Ведите учет всех сделок для анализа
3. **Начинайте с малых сумм**: Тестируйте систему на небольших позициях
4. **Мониторьте уверенность**: Рекомендации с низкой уверенностью требуют особого внимания

### Для разработчиков

1. **Не отключайте проверки**: Политика безопасности — важная часть системы
2. **Расширяйте валидацию**: Добавляйте новые проверки по мере необходимости
3. **Логируйте отклонения**: Отслеживайте случаи, когда рекомендации отклоняются
4. **Тестируйте граничные случаи**: Проверяйте поведение при недостатке данных

## Ограничения ответственности

⚠️ **Важно**: Trading Research Assistant — это инструмент для исследования и анализа, а не автоматическая торговая система. 

- Система не гарантирует прибыльность рекомендаций
- Все торговые решения принимаются пользователем самостоятельно
- Пользователь несет полную ответственность за свои торговые решения
- Рекомендуется использовать систему в сочетании с собственным анализом

## Будущие улучшения

Планируемые улучшения безопасности:

- [ ] Динамическая оценка риска на основе волатильности
- [ ] Проверка корреляции с историческими данными
- [ ] Интеграция с политиками управления рисками
- [ ] Автоматическое ограничение размера позиций
- [ ] Предупреждения о необычных рыночных условиях